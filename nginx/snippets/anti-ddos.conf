# HTTP 访问频率限制与 Anti-DDoS (适用场景：防止暴力破解、恶意接口刷票、DDoS 攻击)
# 使用方式：在 http {} 块中 include /etc/nginx/snippets/anti-ddos.conf; (定义限流桶)
# 注意：本文件仅定义限流区域，具体限流逻辑需在 location 块中通过 limit_req 启用。

# 1. 注册与找回密码 - 严格限制 (每分钟 10 次)
limit_req_zone $binary_remote_addr zone=auth_register:10m rate=10r/m;

# 2. 通用 API 接口 - 中等限制 (每秒 30 次/IP)
limit_req_zone $binary_remote_addr zone=api_requests:10m rate=30r/m;

# 3. 静态资源 - 宽松限制 (每分钟 100 次/IP)
limit_req_zone $binary_remote_addr zone=static_assets:10m rate=100r/m;

# 4. 爬虫与机器人限制
map $http_user_agent $is_crawler {
    default 0;
    ~*(bot|crawler|spider|scraper) 1;
}
limit_req_zone $is_crawler zone=crawler_limit:10m rate=2r/s;

# location 启用方式示例:
# location /api/login {
#     limit_req zone=auth_login burst=10 nodelay;
#     limit_req_status 429;
# }
