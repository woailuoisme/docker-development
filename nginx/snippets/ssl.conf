# SSL & HTTP/3 (QUIC) 整合配置 (适用场景：启用 HTTPS、HTTP2、HTTP3 及 TLS 1.3 性能优化)
# 使用方式：在 server {} 块中 include /etc/nginx/snippets/ssl.conf; (需替换原有 listen 指令)

# 1. 监听配置 (启用 Socket Sharding / Reuseport)
# 性能提升：允许内核均匀分配连接，消除惊群效应。
# 注意：reuseport 在一个 IP:Port 组合上只能定义一次。
listen 443 ssl reuseport;
listen 443 quic reuseport;
http2 on;

# 2. 证书路径
ssl_certificate /etc/nginx/ssl/live/haoxiaoguai.xyz/fullchain.pem;
ssl_certificate_key /etc/nginx/ssl/live/haoxiaoguai.xyz/privkey.pem;

# 3. HTTP/3 响应头 (告知浏览器支持 QUIC)
add_header Alt-Svc 'h3=":443"; ma=86400';

# 4. 基础安全与 WAF 引入
include /etc/nginx/snippets/security-headers.conf;
include /etc/nginx/snippets/waf.conf;

# 5. SSL 加速与优化 (OpenSSL 3.x + TLS 1.3)
# 0-RTT：开启 TLS 1.3 零往返握手加速
ssl_early_data on;
proxy_set_header Early-Data $ssl_early_data;

# KTLS：开启内核级 TLS 加速 (需要 OpenSSL 3.0+ 且宿主机内核支持)
ssl_conf_command Options KTLS;

# 优化建议
# SSL 会话缓存等全局配置保持在 nginx.conf 中
