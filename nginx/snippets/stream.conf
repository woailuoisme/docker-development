# TCP/UDP 流代理配置 (适用场景：PostgreSQL、Redis 等非 HTTP 协议转发)
# 使用方式：在 nginx.conf 的 stream {} 块中 include /etc/nginx/snippets/stream.conf;

# 日志格式定义
log_format stream_log '$remote_addr [$time_local] '
                      '$protocol $status $bytes_sent $bytes_received '
                      '$session_time';

# --- PostgreSQL ---
upstream postgres_backend {
    server postgres:5432;
}

server {
    listen 45432;
    proxy_pass postgres_backend;
    proxy_connect_timeout 10s;
    proxy_timeout 30m;
    access_log /dev/stdout stream_log;
    error_log /dev/stderr;
}

# --- Redis ---
upstream redis_backend {
    server redis:6379;
}

server {
    listen 46379;
    proxy_pass redis_backend;
    proxy_connect_timeout 5s;
    proxy_timeout 60s;
    access_log /dev/stdout stream_log;
    error_log /dev/stderr;
}
