# ============================================================================
# security-headers.conf - Nginx 安全头配置片段
# 由 caddy/snippets/security.conf 移植，保持配置一致
# ============================================================================

# 1. 引用策略控制 - Referrer-Policy
add_header Referrer-Policy "no-referrer-when-downgrade" always;

# 2. HTTP 严格传输安全 - HSTS
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;

# 3. 跨站脚本攻击防护 - X-XSS-Protection
add_header X-XSS-Protection "1; mode=block" always;

# 4. 内容类型嗅探防护 - X-Content-Type-Options
add_header X-Content-Type-Options "nosniff" always;

# 5. 点击劫持防护 - X-Frame-Options
add_header X-Frame-Options "SAMEORIGIN" always;

# 6. 内容安全策略 - Content-Security-Policy (CSP)
add_header Content-Security-Policy "upgrade-insecure-requests" always;

# 7. 隐藏后端信息 (针对 Proxy 场景)
proxy_hide_header X-Powered-By;
proxy_hide_header Via;
proxy_hide_header X-Runtime;
proxy_hide_header X-Version;

# 注意：
# - Referrer-Policy 已从 strict-origin-when-cross-origin 更改为 no-referrer-when-downgrade 以与 Caddy 同步。
# - 添加了 upgrade-insecure-requests CSP 指令。
# - server_tokens off 已在 nginx.conf 全局配置，无需重复设置。