# FastCGI 安全与性能优化 (适用场景：所有 PHP 处理块，增强安全并适配 Laravel)
# 使用方式：在 location ~ \.php$ 块中 include /etc/nginx/snippets/fastcgi-security.conf;

# 1. 隐藏服务器指纹
fastcgi_hide_header X-Powered-By;
fastcgi_hide_header X-Pingback;

# 2. 防御 httpoxy 漏洞 (清空代理请求头)
fastcgi_param HTTP_PROXY "";

# 3. 路径解析安全 (支持现代框架路由)
fastcgi_split_path_info ^(.+\.php)(/.+)$;

# 4. 错误拦截 (允许 Nginx 处理后端错误)
fastcgi_intercept_errors on;

# 5. 缓冲区优化 (适配 Laravel 等大型应用)
fastcgi_buffer_size 32k;
fastcgi_buffers 16 16k;
fastcgi_busy_buffers_size 64k;

# 6. 安全超时设置
fastcgi_connect_timeout 60s;
fastcgi_send_timeout 180s;
fastcgi_read_timeout 180s;