; ============================================================================
; WordPress 生产环境 PHP 核心优化配置
; ============================================================================

; --- 资源限制 ---
; 上传大小 (建议与 post_max_size 保持一致)
upload_max_filesize = 64M
post_max_size = 64M
; 内存限制 (建议 256M 或 512M)
memory_limit = 512M
; 执行时间 (秒)
max_execution_time = 300
max_input_time = 300

; ============================================================================
; Opcache 性能优化 (PHP 8.x)
; ============================================================================
[opcache]
; 开启 Opcache
opcache.enable=1
; 开启命令行下的加速
opcache.enable_cli=1
; 提升内存 (默认 128)
opcache.memory_consumption=256
; 暂存字符串的内存量 (默认 8)
opcache.interned_strings_buffer=16
; 提升文件缓存上限 (根据项目文件数调整，Laravel/WP 建议 10000+)
opcache.max_accelerated_files=10000
; 验证时间戳 (生产环境设为 0 可略微提升性能，但部署时需重启 PHP)
opcache.validate_timestamps=1
opcache.revalidate_freq=2

; --- JIT 编译器 (PHP 8.0+ 核心优势) ---
; tracing 模式通常提供最佳的真实世界性能
opcache.jit=tracing
; 为 JIT 分配的缓冲区大小
opcache.jit_buffer_size=100M

; ============================================================================
; Redis 扩展优化 (PhpRedis)
; ============================================================================
[redis]
; --- 连接池与持久连接 ---
; 是否开启连接池 (减少频繁创建连接的开销)
redis.pconnect.pooling_enabled = On
; 连接池内允许的最大连接数 (-1 为不限制)
redis.pconnect.connection_limit = -1
; 开启存活性检查 (防止 Connection lost 报错)
redis.pconnect.echo_check_liveness = On

; --- Session 锁配置 (仅当使用 Redis 存储 Session 时) ---
; redis.session.locking_enabled = On
; redis.session.lock_expire = 20
; redis.session.lock_retries = 10
; redis.session.lock_wait = 20000