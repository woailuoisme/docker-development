# ============================================================================
# rate-limit.conf - Caddy 速率限制 (Rate Limiting) 片段
# ============================================================================
#
# 注意：此配置需要 Caddy 安装了插件: github.com/mholt/caddy-ratelimit
# 
# 使用方法:
# 在站点或路由配置中导入对应的片段：
#   example.com {
#       import ratelimit-default
#       ...
#   }
# ============================================================================

# 1. 通用 API 限制 (每个 IP 2秒内最多5次)
(ratelimit-default) {
	rate_limit {
		zone default_limit {
			key {remote_host}
			window 2s
			events 5
		}
	}
}

# 2. 严格限制 (针对登录/注册, 1分钟内最多10次)
(ratelimit-auth) {
	rate_limit {
		zone auth_limit {
			key {remote_host}
			window 1m
			events 10
		}
	}
}

# 3. 搜索服务限制 (针对重负载接口, 10秒内最多3次)
(ratelimit-search) {
	rate_limit {
		zone search_limit {
			key {remote_host}
			window 10s
			events 3
		}
	}
}

# 4. 静态资源/高频限制 (1秒内最多30次)
(ratelimit-assets) {
	rate_limit {
		zone assets_limit {
			key {remote_host}
			window 1s
			events 30
		}
	}
}
