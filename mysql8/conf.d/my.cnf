[mysqld]
# --- 基础与字符集 ---
# 默认字符集设置为极力推荐的 utf8mb4
character-set-server=utf8mb4
collation-server=utf8mb4_unicode_ci

# --- 认证插件 ---
# 8.4 默认已经是 caching_sha2_password，且该参数已移除
# 如果需显式指定或修改策略，8.4 推荐使用 authentication_policy
# authentication_policy=caching_sha2_password
# 兼容性提示：如果旧版客户端(如 Navicat 12)连不上，请取消下面一行的注释
# mysql_native_password=ON

# --- 网络与连接优化 (高并发适配) ---
# 禁用 DNS 反向解析，加快连接速度
skip-name-resolve
# 积压请求队列大小，防止瞬间高并发拒绝连接
back_log=512
# 线程缓存数量，复用线程减少创建开销
thread_cache_size=50
# 最大数据包大小，防止导入大 SQL 报错
max_allowed_packet=64M

# --- 内存与性能优化 (2C1G 专配) ---
# InnoDB 缓冲池，建议设为内存的 50% (512M)
innodb_buffer_pool_size=512M
# 缓冲池实例数，小内存设为 1 减少开销
innodb_buffer_pool_instances=1
# Redo Log 总容量，通常等于缓冲池大小
innodb_redo_log_capacity=512M
# 事务日志缓冲区，适中即可
innodb_log_buffer_size=16M
# 刷盘策略：2 (每秒刷盘)，写入性能最高
innodb_flush_log_at_trx_commit=2
# Binlog 同步频率：1000 次事务刷一次盘，提升性能
sync_binlog=1000

# --- 临时表与查询优化 ---
# 内存临时表上限，防止复杂查询撑爆内存
tmp_table_size=32M
max_heap_table_size=32M
# 表描述符缓存，影响打开表的速度
table_open_cache=2000
# 允许打开的文件句柄上限
open_files_limit=65535

# --- SSD IO 性能微调 ---
# IO 吞吐量基准值 (阿里云 SSD 建议 2000)
innodb_io_capacity=2000
# IO 吞吐量最大值 (阿里云 SSD 可设为 4000-8000)
innodb_io_capacity_max=4000
# 写 IO 线程数，适配 2 核 CPU
innodb_write_io_threads=4
# 读 IO 线程数，适配 2 核 CPU
innodb_read_io_threads=4
# 绕过系统缓存直接写盘，节省内存且防止丢数据
innodb_flush_method=O_DIRECT

# --- 连接与限制 ---
# 最大并发连接数，1G 内存不宜超过 300
max_connections=300

# --- 慢查询日志 ---
# 开启慢查询日志
slow_query_log=1
# 超过 1 秒即记录
long_query_time=1
# 慢日志文件路径
slow_query_log_file=/var/lib/mysql/mysql-slow.log