# ========================================
# RabbitMQ 优化配置 (2核 1GB 环境)
# ========================================

# 1. 内存保护：双核下调度更积极
vm_memory_high_watermark.absolute = 600MB
vm_memory_high_watermark_paging_ratio = 0.5

# 2. 磁盘限制
disk_free_limit.absolute = 1GB

# 3. 性能与监控平衡 (双核版)
# 将 collect_statistics 改为 fine，可以看到每条队列的详细速率，双核 CPU 扛得住
collect_statistics = fine
# 统计数据保留策略：开启详细模式
management.rates_mode = detailed

# 4. CPU & 多线程优化
# 预读缓存：适当增加以匹配双核处理能力
consumer_prefetch_count = 300

# 5. IO 优化
# 小消息嵌入索引（保持 4KB 也是最佳实践）
queue_index_embed_msgs_below = 4096

# 6. 内存碎片整理 (Erlang GC 优化)
# 开启后台 GC 任务，利用多出的核心在后台清理过期数据
# 这在双核环境下不容易产生突发的卡顿
background_gc_enabled = true
background_gc_target_interval = 60000