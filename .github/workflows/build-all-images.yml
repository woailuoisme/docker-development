name: Build All Images (Multi-Select)

on:
  workflow_dispatch:
    inputs:
      # === åˆ†ç»„æ§åˆ¶ ===
      build_all:
        description: 'ğŸš€ æ„å»ºæ‰€æœ‰é•œåƒ'
        type: boolean
        default: false
      build_all_php:
        description: 'ğŸ“¦ æ„å»ºæ‰€æœ‰ PHP æœåŠ¡'
        type: boolean
        default: false
      build_all_infra:
        description: 'ğŸ”§ æ„å»ºæ‰€æœ‰åŸºç¡€è®¾æ–½'
        type: boolean
        default: false
      
      # === è‡ªå®šä¹‰æ„å»º ===
      custom_services:
        description: 'ğŸ” æŒ‡å®šæœåŠ¡ (é€—å·åˆ†éš”ï¼Œå¦‚: redis, mysql, php-fpm)'
        required: false
        type: string
        default: ''
      
      # === é€šç”¨å‚æ•° ===
      image_tag:
        description: 'é•œåƒæ ‡ç­¾ (e.g., latest)'
        required: true
        default: 'latest'
      
      # ç‰ˆæœ¬å‚æ•° (å¯é€‰)
      authelia_version:
        description: 'Authelia ç‰ˆæœ¬ (é»˜è®¤: 4.39)'
        required: false
        default: '4.39'
      mysql_version:
        description: 'MySQL ç‰ˆæœ¬ (é»˜è®¤: 8.4)'
        required: false
        default: '8.4'
      mongo_version:
        description: 'MongoDB ç‰ˆæœ¬ (é»˜è®¤: 8.0)'
        required: false
        default: '8.0'
      redis_version:
        description: 'Redis ç‰ˆæœ¬ (é»˜è®¤: 8.4-alpine)'
        required: false
        default: '8.4-alpine'
      pgsql_version:
        description: 'PostgreSQL Version (é»˜è®¤: 18.2)'
        required: false
        default: '18.2'
      meili_version:
        description: 'Meilisearch Version (é»˜è®¤: v1.33)'
        required: false
        default: 'v1.33'

jobs:
  # PHP Trixie æœåŠ¡æ„å»º
  build-php-fpm-trixie:
    if: ${{ inputs.build_all == true || inputs.build_all_php == true || inputs.build_php_fpm_trixie == true }}
    uses: ./.github/workflows/build-php-fpm-trixie.yml
    secrets: inherit
    with:
      tag: ${{ inputs.image_tag }}

  build-php-franken-trixie:
    if: ${{ inputs.build_all == true || inputs.build_all_php == true || inputs.build_php_franken_trixie == true }}
    uses: ./.github/workflows/build-php-franken-trixie.yml
    secrets: inherit
    with:
      tag: ${{ inputs.image_tag }}

  build-php-horizon-trixie:
    if: ${{ inputs.build_all == true || inputs.build_all_php == true || inputs.build_php_horizon_trixie == true }}
    uses: ./.github/workflows/build-php-horizon-trixie.yml
    secrets: inherit
    with:
      tag: ${{ inputs.image_tag }}

  build-php-roadrunner-trixie:
    if: ${{ inputs.build_all == true || inputs.build_all_php == true || inputs.build_php_roadrunner_trixie == true }}
    uses: ./.github/workflows/build-php-roadrunner-trixie.yml
    secrets: inherit
    with:
      tag: ${{ inputs.image_tag }}

  build-php-reverb-trixie:
    if: ${{ inputs.build_all == true || inputs.build_all_php == true || inputs.build_php_reverb_trixie == true }}
    uses: ./.github/workflows/build-php-reverb-trixie.yml
    secrets: inherit
    with:
      tag: ${{ inputs.image_tag }}

  build-php-schedule-trixie:
    if: ${{ inputs.build_all == true || inputs.build_all_php == true || inputs.build_php_schedule_trixie == true }}
    uses: ./.github/workflows/build-php-schedule-trixie.yml
    secrets: inherit
    with:
      tag: ${{ inputs.image_tag }}

  build-php-worker-trixie:
    if: ${{ inputs.build_all == true || inputs.build_all_php == true || inputs.build_php_worker_trixie == true }}
    uses: ./.github/workflows/build-php-worker-trixie.yml
    secrets: inherit
    with:
      tag: ${{ inputs.image_tag }}

  # åŸºç¡€è®¾æ–½æœåŠ¡æ„å»º
  build-goaccess:
    if: ${{ inputs.build_all == true || inputs.build_all_infra == true || inputs.build_goaccess == true }}
    uses: ./.github/workflows/build-goaccess.yml
    secrets: inherit
    with:
      tag: ${{ inputs.image_tag }}

  build-authelia:
    if: ${{ inputs.build_all == true || inputs.build_all_infra == true || inputs.build_authelia == true }}
    uses: ./.github/workflows/build-authelia.yml
    secrets: inherit
    with:
      authelia_version: ${{ inputs.authelia_version }}
      tag: ${{ inputs.image_tag }}

  build-caddy:
    if: ${{ inputs.build_all == true || inputs.build_all_infra == true || inputs.build_caddy == true }}
    uses: ./.github/workflows/build-caddy.yml
    secrets: inherit
    with:
      tag: ${{ inputs.image_tag }}

  build-mysql8:
    if: ${{ inputs.build_all == true || inputs.build_all_infra == true || inputs.build_mysql8 == true }}
    uses: ./.github/workflows/build-mysql8.yml
    secrets: inherit
    with:
      mysql_version: ${{ inputs.mysql_version }}
      tag: ${{ inputs.image_tag }}

  build-mongodb:
    if: ${{ inputs.build_all == true || inputs.build_all_infra == true || inputs.build_mongodb == true }}
    uses: ./.github/workflows/build-mongodb.yml
    secrets: inherit
    with:
      mongo_version: ${{ inputs.mongo_version }}
      tag: ${{ inputs.image_tag }}

  build-telegraf:
    if: ${{ inputs.build_all == true || inputs.build_all_infra == true || inputs.build_telegraf == true }}
    uses: ./.github/workflows/build-telegraf.yml
    secrets: inherit
    with:
      tag: ${{ inputs.image_tag }}

  build-redis:
    if: ${{ inputs.build_all == true || inputs.build_all_infra == true || inputs.build_redis == true }}
    uses: ./.github/workflows/build-redis.yml
    secrets: inherit
    with:
      redis_version: ${{ inputs.redis_version }}
      tag: ${{ inputs.image_tag }}

  build-meilisearch:
    if: ${{ inputs.build_all == true || inputs.build_all_infra == true || inputs.build_meilisearch == true }}
    uses: ./.github/workflows/build-meilisearch.yml
    secrets: inherit
    with:
      meili_version: ${{ inputs.meili_version }}
      tag: ${{ inputs.image_tag }}

  build-minio:
    if: ${{ inputs.build_all == true || inputs.build_all_infra == true || inputs.build_minio == true }}
    uses: ./.github/workflows/build-minio.yml
    secrets: inherit
    with:
      tag: ${{ inputs.image_tag }}

  build-pgsql-17:
    if: ${{ inputs.build_all == true || inputs.build_all_infra == true || inputs.build_pgsql_17 == true }}
    uses: ./.github/workflows/build-pgsql-17.yml
    secrets: inherit
    with:
      postgres_version: ${{ inputs.pgsql_version }}
      tag: ${{ inputs.image_tag }}

  build-pgsql-18:
    if: ${{ inputs.build_all == true || inputs.build_all_infra == true || inputs.build_pgsql_18 == true }}
    uses: ./.github/workflows/build-pgsql-18.yml
    secrets: inherit
    with:
      postgres_version: ${{ inputs.pgsql_version }}
      tag: ${{ inputs.image_tag }}
