name: Build Group - Database Services

on:
  workflow_dispatch:
    inputs:
      # === æ§åˆ¶å¼€å…³ ===
      build_all:
        description: 'ğŸš€ æ„å»ºæ‰€æœ‰æ•°æ®åº“æœåŠ¡'
        type: boolean
        default: false
      
      build_mysql8:
        description: 'æ„å»º MySQL8'
        type: boolean
        default: false
      build_mongodb:
        description: 'æ„å»º MongoDB'
        type: boolean
        default: false
      build_redis:
        description: 'æ„å»º Redis'
        type: boolean
        default: false
      build_pgsql_17:
        description: 'æ„å»º PostgreSQL 17'
        type: boolean
        default: false
      build_pgsql_18:
        description: 'æ„å»º PostgreSQL 18'
        type: boolean
        default: false
      
      # === é€šç”¨å‚æ•° ===
      image_tag:
        description: 'é•œåƒæ ‡ç­¾ (e.g., latest)'
        required: true
        default: 'latest'

      # === ç‰ˆæœ¬å‚æ•° ===
      mysql_version:
        description: 'MySQL ç‰ˆæœ¬ (é»˜è®¤: 8.4)'
        required: false
        default: '8.4'
      mongo_version:
        description: 'MongoDB ç‰ˆæœ¬ (é»˜è®¤: 8.0)'
        required: false
        default: '8.0'
      redis_version:
        description: 'Redis ç‰ˆæœ¬ (é»˜è®¤: 8.4-alpine)'
        required: false
        default: '8.4-alpine'
      pgsql_version:
        description: 'PostgreSQL Version (é»˜è®¤: 18.2)'
        required: false
        default: '18.2'

jobs:
  build-mysql8:
    if: ${{ inputs.build_all == true || inputs.build_mysql8 == true }}
    uses: ./.github/workflows/build-mysql8.yml
    secrets: inherit
    with:
      mysql_version: ${{ inputs.mysql_version }}
      tag: ${{ inputs.image_tag }}

  build-mongodb:
    if: ${{ inputs.build_all == true || inputs.build_mongodb == true }}
    uses: ./.github/workflows/build-mongodb.yml
    secrets: inherit
    with:
      mongo_version: ${{ inputs.mongo_version }}
      tag: ${{ inputs.image_tag }}

  build-redis:
    if: ${{ inputs.build_all == true || inputs.build_redis == true }}
    uses: ./.github/workflows/build-redis.yml
    secrets: inherit
    with:
      redis_version: ${{ inputs.redis_version }}
      tag: ${{ inputs.image_tag }}

  build-pgsql-17:
    if: ${{ inputs.build_all == true || inputs.build_pgsql_17 == true }}
    uses: ./.github/workflows/build-pgsql-17.yml
    secrets: inherit
    with:
      postgres_version: ${{ inputs.pgsql_version }}
      tag: ${{ inputs.image_tag }}

  build-pgsql-18:
    if: ${{ inputs.build_all == true || inputs.build_pgsql_18 == true }}
    uses: ./.github/workflows/build-pgsql-18.yml
    secrets: inherit
    with:
      postgres_version: ${{ inputs.pgsql_version }}
      tag: ${{ inputs.image_tag }}
