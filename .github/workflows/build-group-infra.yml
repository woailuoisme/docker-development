name: Build Group - Infrastructure Services

on:
  workflow_dispatch:
    inputs:
      # === æ§åˆ¶å¼€å…³ ===
      build_all:
        description: 'ğŸš€ æ„å»ºæ‰€æœ‰åŸºç¡€æœåŠ¡'
        type: boolean
        default: false
      
      build_goaccess:
        description: 'æ„å»º GoAccess'
        type: boolean
        default: false
      build_authelia:
        description: 'æ„å»º Authelia'
        type: boolean
        default: false
      build_caddy:
        description: 'æ„å»º Caddy'
        type: boolean
        default: false
      build_telegraf:
        description: 'æ„å»º Telegraf'
        type: boolean
        default: false
      build_meilisearch:
        description: 'æ„å»º Meilisearch'
        type: boolean
        default: false
      build_minio:
        description: 'æ„å»º MinIO'
        type: boolean
        default: false
      
      # === é€šç”¨å‚æ•° ===
      image_tag:
        description: 'é•œåƒæ ‡ç­¾ (e.g., latest)'
        required: true
        default: 'latest'

      # === ç‰ˆæœ¬å‚æ•° ===
      authelia_version:
        description: 'Authelia ç‰ˆæœ¬ (é»˜è®¤: 4.39)'
        required: false
        default: '4.39'
      meili_version:
        description: 'Meilisearch Version (é»˜è®¤: v1.33)'
        required: false
        default: 'v1.33'

jobs:
  build-goaccess:
    if: ${{ inputs.build_all == true || inputs.build_goaccess == true }}
    uses: ./.github/workflows/build-goaccess.yml
    secrets: inherit
    with:
      tag: ${{ inputs.image_tag }}

  build-authelia:
    if: ${{ inputs.build_all == true || inputs.build_authelia == true }}
    uses: ./.github/workflows/build-authelia.yml
    secrets: inherit
    with:
      authelia_version: ${{ inputs.authelia_version }}
      tag: ${{ inputs.image_tag }}

  build-caddy:
    if: ${{ inputs.build_all == true || inputs.build_caddy == true }}
    uses: ./.github/workflows/build-caddy.yml
    secrets: inherit
    with:
      tag: ${{ inputs.image_tag }}

  build-telegraf:
    if: ${{ inputs.build_all == true || inputs.build_telegraf == true }}
    uses: ./.github/workflows/build-telegraf.yml
    secrets: inherit
    with:
      tag: ${{ inputs.image_tag }}

  build-meilisearch:
    if: ${{ inputs.build_all == true || inputs.build_meilisearch == true }}
    uses: ./.github/workflows/build-meilisearch.yml
    secrets: inherit
    with:
      meili_version: ${{ inputs.meili_version }}
      tag: ${{ inputs.image_tag }}

  build-minio:
    if: ${{ inputs.build_all == true || inputs.build_minio == true }}
    uses: ./.github/workflows/build-minio.yml
    secrets: inherit
    with:
      tag: ${{ inputs.image_tag }}
