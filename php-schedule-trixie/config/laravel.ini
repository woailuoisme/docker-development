; ============================================================================
; Laravel Octane/RoadRunner 生产环境 PHP 配置
; ============================================================================

; 设置默认时区
date.timezone = Asia/Shanghai

; 设置默认字符集
default_charset = "UTF-8"

; 设置 PHP 变量注册顺序（EGPCS: Environment, Get, Post, Cookie, Server）
; 必须包含 'E' 才能在 $_ENV 中读取环境变量
variables_order = "EGPCS"

; ============================================================================
; 错误处理（生产环境）
; ============================================================================

; 关闭错误显示（安全）
display_errors = Off
display_startup_errors = Off

; 开启错误日志记录
log_errors = On

; 错误日志输出到标准错误流（Docker 日志收集）
error_log = /proc/self/fd/2

; 错误报告级别（生产环境：只记录错误和警告）
error_reporting = E_ALL & ~E_DEPRECATED & ~E_STRICT

; ============================================================================
; 内存和执行时间配置（RoadRunner 优化）
; ============================================================================

; PHP 内存限制（RoadRunner 长驻进程建议更大）
memory_limit = 256M

; 最大执行时间（秒）- RoadRunner 建议设置较长
max_execution_time = 300

; 最大输入时间（秒）
max_input_time = 300

; 默认 Socket 超时时间（秒）
default_socket_timeout = 300

; ============================================================================
; 文件上传配置
; ============================================================================

; 上传文件大小限制
upload_max_filesize = 100M

; POST 数据大小限制（必须 >= upload_max_filesize）
post_max_size = 100M

; 最大上传文件数
max_file_uploads = 20

; ============================================================================
; 性能优化
; ============================================================================

; 启用 Realpath 缓存（减少文件系统调用）
realpath_cache_size = 4M
realpath_cache_ttl = 600

; 禁用危险函数（安全）- 保留 Laravel 需要的函数
; 注意：proc_open, exec 被 Symfony Process 使用，不能禁用

; 输出缓冲（提升性能）
output_buffering = 4096

; 启用 Zlib 压缩
zlib.output_compression = On
zlib.output_compression_level = 6

; ============================================================================
; 会话配置
; ============================================================================

; Laravel 通过 config/session.php 管理会话存储
; 这里只设置 Cookie 安全选项
session.cookie_httponly = 1
session.cookie_secure = 1
session.cookie_samesite = "Lax"

; ============================================================================
; 访问日志格式（可选）
; ============================================================================

; 自定义访问日志格式
; access.format = "%R - %{%F %T}t \"%m %r\" %s \"%f\" %ds %MMB"


