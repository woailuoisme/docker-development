<clickhouse>
    <!-- ======================================================= -->
    <!-- ClickHouse 低内存与双核性能优化配置 (LTS 25.8 适配版) -->
    <!-- ======================================================= -->

    <!-- 1. 缓存压缩：大幅降低元数据与原始数据的内存占用 -->
    <mark_cache_size>256000000</mark_cache_size>
    <uncompressed_cache_size>128000000</uncompressed_cache_size>
    
    <!-- 2. 连接限制：针对低配服务器，限制最大并发连接数 -->
    <max_connections>128</max_connections>

    <!-- 3. 后台任务控制：匹配双核 CPU，防止后台合并任务耗尽资源 -->
    <background_pool_size>2</background_pool_size>
    <background_move_pool_size>2</background_move_pool_size>
    <background_schedule_pool_size>4</background_schedule_pool_size>
    <background_merges_mutations_concurrency_ratio>1</background_merges_mutations_concurrency_ratio>

    <!-- 4. 写入性能优化：异步写入 (Async Insert) -->
    <async_insert>1</async_insert>
    <async_insert_max_data_size>100000</async_insert_max_data_size>
    <async_insert_busy_timeout_ms>200</async_insert_busy_timeout_ms>

    <!-- 5. 内存管理策略 -->
    <max_server_memory_usage_to_ram_ratio>0.9</max_server_memory_usage_to_ram_ratio>
    <min_free_ram_to_start_background_process>128000000</min_free_ram_to_start_background_process>

</clickhouse>